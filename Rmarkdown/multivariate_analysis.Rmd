---
title: "Multivariate Meta-Analysis for Longevity and Reproduction"
author: "Daniel Noble & Fay Frost"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r, packages,echo = FALSE}
install.packages("pacman")
pacman::p_load(tidyverse, here, metafor)
```

```{r, load data, echo = FALSE}
## Load in the finalised data
  data <- read.csv(here("data", "cleaned_unique_combo.csv"))
```

```{r, check data, echo = FALSE, include=FALSE}

#  Let's just orient the data length wise as we need it in this format first.
  
  data_long <- data %>% pivot_longer(cols = c(es.reproduction, es.longevity, v.reproduction, v.longevity), names_to = "outcome", values_to = "es") %>% data.frame()
  
  # Not quite where we need it, so lets filter out v and then cbind together
  data_long_es <- data_long %>% filter(outcome %in% c("es.reproduction", "es.longevity"))
   data_long_v <- data_long %>% filter(outcome %in% c("v.reproduction", "v.longevity"))
  
  # All information should now be ordered correctly and the data frames the same dimensions. We can check
  dim(data_long_es)
  dim(data_long_v)
  
# Now, bind these together
  data_long_final <- cbind(data_long_es, v = data_long_v$es)
  
# Now, let's check that this data is set up correctly. If we group by Experiment.code, diff and outcome then we should have a maximum of 1 effect size for each study/diff in each outcome category
  check <- data_long_final %>% group_by(Experiment.code, diff, outcome) %>% summarise(n=n()) %>% filter(n !=1)

# OUTCOME: There still appear to be columns(~40) with more than 1 effect size for each longevity/reproduction effect size. This is also not because we could have males and female effect sizes as including sex does not resolve this problem
  
# The Experiment code identifiers that are relevant are:
  unique(check$Experiment.code)
  
```

